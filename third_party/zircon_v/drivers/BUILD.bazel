# Bazel BUILD file for V language drivers
# These are Allwinner A527 peripheral drivers translated to V

load("//build:v_rules.bzl", "v_library", "v_test")

package(default_visibility = ["//visibility:public"])

# =============================================================================
# MMC/SDHCI Driver
# =============================================================================

v_library(
    name = "sunxi_mmc_regs",
    srcs = ["mmc/sunxi_mmc_regs.v"],
    deps = [],
)

v_library(
    name = "sunxi_mmc",
    srcs = ["mmc/sunxi_mmc.v"],
    deps = [":sunxi_mmc_regs"],
)

v_test(
    name = "sunxi_mmc_test",
    srcs = [
        "mmc/sunxi_mmc_regs.v",
        "mmc/sunxi_mmc.v",
    ],
    deps = [],
)

# =============================================================================
# Clock Control Unit (CCU) Driver
# =============================================================================

v_library(
    name = "a527_ccu_regs",
    srcs = ["clock/a527_ccu_regs.v"],
    deps = [],
)

v_library(
    name = "sunxi_ccu",
    srcs = ["clock/sunxi_ccu.v"],
    deps = [":a527_ccu_regs"],
)

v_test(
    name = "sunxi_ccu_test",
    srcs = [
        "clock/a527_ccu_regs.v",
        "clock/sunxi_ccu.v",
    ],
    deps = [],
)

# =============================================================================
# GPIO (PIO) Driver
# =============================================================================

v_library(
    name = "sunxi_gpio_regs",
    srcs = ["gpio/sunxi_gpio_regs.v"],
    deps = [],
)

v_library(
    name = "sunxi_gpio",
    srcs = ["gpio/sunxi_gpio.v"],
    deps = [":sunxi_gpio_regs"],
)

v_test(
    name = "sunxi_gpio_test",
    srcs = [
        "gpio/sunxi_gpio_regs.v",
        "gpio/sunxi_gpio.v",
    ],
    deps = [],
)

# =============================================================================
# I2C (TWI) Driver
# =============================================================================

v_library(
    name = "sunxi_i2c_regs",
    srcs = ["i2c/sunxi_i2c_regs.v"],
    deps = [],
)

v_library(
    name = "sunxi_i2c",
    srcs = ["i2c/sunxi_i2c.v"],
    deps = [":sunxi_i2c_regs"],
)

v_test(
    name = "sunxi_i2c_test",
    srcs = [
        "i2c/sunxi_i2c_regs.v",
        "i2c/sunxi_i2c.v",
    ],
    deps = [],
)

# =============================================================================
# Combined driver package
# =============================================================================

v_library(
    name = "sunxi_drivers",
    srcs = [],
    deps = [
        ":sunxi_mmc",
        ":sunxi_ccu",
        ":sunxi_gpio",
        ":sunxi_i2c",
    ],
)
