import("//build/v_rules.gni")
import("//build/driver_package.gni")

# V IPC library compiled from translated Zircon sources
v_library("zircon_v_ipc") {
  sources = [
    "handle.v",
    "message_packet.v",
    "channel.v",
  ]
  
  output_name = "zircon_v_ipc"
  
  visibility = [
    "//boards/arm64/soliloquy:*",
    "//src/shell:*",
    "//third_party/zircon_v/ipc/shims:*",
  ]
}

# Rust shim library for FFI to V IPC
rustc_library("zircon_v_ipc_shims") {
  name = "zircon_v_ipc_shims"
  edition = "2021"
  
  sources = [
    "shims/mod.rs",
  ]
  
  deps = [
    ":zircon_v_ipc",
  ]
  
  visibility = [
    "//boards/arm64/soliloquy:*",
    "//src/shell:*",
  ]
}

group("all") {
  deps = [
    ":zircon_v_ipc",
    ":zircon_v_ipc_shims",
  ]
}

v_object("ipc_smoke") {
  testonly = true
  sources = [ "ipc_smoke.v" ]
  deps = [ ":zircon_v_ipc" ]
  output_name = "ipc_smoke"
}

group("tests") {
  testonly = true
  deps = [
    ":ipc_smoke",
  ]
}
